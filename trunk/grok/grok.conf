patterns {
		APACHE_ERROR = ".*";
};

file "/var/log/auth.log" {
	# Handle "Last message repeated X times" 
	syslog = 1;

	# If any root login is attempted, kill it.
	type "root login attempt" {
		match = "Failed \w+ for root from %IP%";
		threshold = 1;
		interval = 600;
		reaction = "pfctl -t whores -T add %IP%";
	};
	type "bad username" {
		match = "Illegal user %USERNAME% from %IP%";
		match = "Failed none for illegal user %USERNAME% from %IP% port %PORT%";
		threshold = 4;
		interval = 3600;
		reaction = "pfctl -t whores -T add %IP%";
	};
	type "failed password" {
		match = "Failed password for (illegal user)? %USERNAME% from %IP% port %PORT%";
		threshold = 5;
		interval = 60;
		reaction = "pfctl -t whores -T add %IP%";
	};

	type "faulty connection attempt" {
		match = "Did not receive identification string from %IP%";
		threshold = 1;
		interval = 600;
		reaction = "pfctl -t whores -T add %IP%";
	};
};

file "/var/log/httpd-access.log" {
	type "normal get request" {
		match = "%IP% - - .*? \"GET /";
	};
};

file "/misc/var/log/httpd-error.log" {
	type "plain old error" {
		match = "\[.*?\] \[error\] \[client %IP%] %APACHE_ERROR%";
		threshold = 1;
		interval = 600;
		reaction = "echo 'IP: %IP% --- Error: %APACHE_ERROR%'";
	};
};

file "/var/log/messages" {
	syslog = 1;
};
